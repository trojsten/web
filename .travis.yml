language: python
python:
  - "2.7"
  - "3.5"
env:
  - DJANGO_VERSION='>=1.9,<1.10'
services:
  - elasticsearch
# To ensure, that elasticsearch is available
before_script:
  - sleep 10
# command to install dependencies

matrix:
  include:
  - python: "3.5"
    env: TEST_PEP8=True
    install: pip install flake8
    script: flake8 trojsten


install:
  - pip install --upgrade pip==8.1.1 pip-tools
  - if [[ $TRAVIS_PYTHON_VERSION != 2.7 ]]; then rm requirements.txt; pip-compile requirements.in -o requirements.txt; fi
  - pip install -r requirements.txt;
  - pip install -q "Django${DJANGO_VERSION}"
  - pip install -q coverage
  - pip install -q codeclimate-test-reporter
  - bash -c 'cd trojsten; python ../manage.py compilemessages;'
# command to run tests
script:
  - coverage run --source='./trojsten' --omit 'trojsten/settings/*,trojsten/special/*' manage.py test
after_success:
  - bash <(curl -s https://codecov.io/bash) -t 1f124dcd-a10f-4773-90f7-6b5e304335ac
sudo: false
addons:
    code_climate:
        repo_token: a2d4a42a85b041da0c9d964e43de5a0bd632e7191ce66b262f6fdbe4fef83047
