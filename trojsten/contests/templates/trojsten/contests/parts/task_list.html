{% load utils %}
<!-- Nav tabs -->

{% if categories.count > 1 %}
<ul class="nav nav-tabs" role="tablist">
    <li class="active">
        <a href="#category-tab-all" role="tab" data-toggle="tab"
           onclick="$('#task-list-{{ round.id }} tr').show()">
            Všetky
        </a>
    </li>
    {% for category in categories %}
    <li>
        <a href="#category-tab-{{ category }}" role="tab" data-toggle="tab"
           onclick="$('#task-list-{{ round.id }} tr:not(.category-{{ category }})').hide();$('#task-list-{{ round.id }} tr.category-{{ category }}').show();$('#task-list-{{ round.id }} thead>tr').show();">
            {{ category }}
        </a>
    </li>
    {% endfor %}
</ul>
{% endif %}

<div class="table-responsive">
<table class="table table-condensed task-list" id="task-list-{{ round.id }}">
<thead>
<tr>
    <th width="5%">
        #
    </th>
    <th>
        Úloha
    </th>
    {% if solutions_visible %}
    <th width="15%">
        Vzoráky
        {% if not round.solutions_visible %}
            <small>
                <span class="label label-danger" title="skryté"
                      data-toggle="tooltip" data-placement="top">skr.</span>
            </small>
        {% endif %}
    </th>
    {% endif %}
    {% if categories.count > 0 %}
        <th width="15%">
            Kategória
        </th>
    {% endif %}
    {% if user.is_authenticated %}
        {% if show_description_col %}
        <th width="10%">
            Popis
        </th>
        {% endif %}
        {% if show_source_col %}
        <th width="10%">
            Program
        </th>
        {% endif %}
    {% else %}
    <th width="15%">
        Body
    </th>
    {% endif %}
</tr>
</thead>
{% for task in tasks %}
    <tr class="{% for category in task.categories.all %} category-{{ category }}{% endfor %}">
        <td>
            {{ task.number }}.
        </td>
        <td>
            <a href="{% url 'task_statement' task_id=task.id %}">{{ task.name }}</a>
        </td>
        {% if solutions_visible %}
            <td>
                <a href="{% url 'solution_statement' task_id=task.id %}">vzorák</a>
            </td>
        {% endif %}
        {% if categories.count > 0 %}
            <td>
                {% for category in task.categories.all %}
                    <span class="label label-default category-{{ category }}">{{ category }}</span>
                {% endfor %}
            </td>
        {% endif %}
        {% if not user.is_authenticated %}
        <td>
            {% if task.description_points > 0 %}
                <span class="points-item">popis:&nbsp;{{ task.description_points }}</span>
                {% if task.source_points > 0 %}<br/>{% endif %}
            {% endif %}
            {% if task.source_points > 0 %}
                <span class="points-item">program:&nbsp;{{ task.source_points }}</span>
            {% endif %}
        </td>
        {% else %}
            {% lookup_as points.tasks task.id as task_points %}
            {% if show_description_col %}
            <td>
                {% if task.description_points > 0 %}
                    {% if task_points.description_pending %}
                    <i class="glyphicon glyphicon-time task-status-submitted" data-toggle="tooltip" data-placement="top" data-original-title="popis: čaká na opravenie"></i>
                    {% elif task_points.submitted_description %}
                    <i class="glyphicon glyphicon-ok-circle task-status-ok" data-toggle="tooltip" data-placement="top" data-original-title="popis: opravený"></i>
                    {% else %}
                    <i class="glyphicon glyphicon-ban-circle task-status-empty" data-toggle="tooltip" data-placement="top" data-original-title="popis: neodovzdaný"></i>
                    {% endif %}

                    <b>{% if task_points.description_pending %}??{% else %}{{ task_points.description_points }}{% endif %}</b>&nbsp;/&nbsp;{{ task.description_points }}
                {% else %}
                    <i class="glyphicon glyphicon-minus task-status-disabled" data-toggle="tooltip" data-placement="top" data-original-title="popis: neodovzáva sa"></i>
                {% endif %}
            </td>
            {% endif %}
            {% if show_source_col %}
            <td>
                {% if task.source_points > 0 %}
                    {% if task_points.submitted_source %}
                    {% if task_points.source_points == task.source_points %}
                    <i class="glyphicon glyphicon-ok-circle task-status-ok" data-toggle="tooltip" data-placement="top" data-original-title="program: odovzdaný ({{ task_points.source_points }}b)"></i>
                    {% else %}
                    <i class="glyphicon glyphicon-remove-circle task-status-wrong"  data-toggle="tooltip" data-placement="top" data-original-title="program: odovzdaný ({{ task_points.source_points }}b)"></i>
                    {% endif %}
                    {% else %}
                    <i class="glyphicon glyphicon-ban-circle task-status-empty" data-toggle="tooltip" data-placement="top" data-original-title="program: neodovzdaný"></i>
                    {% endif %}

                    <b>{{ task_points.source_points }}</b>&nbsp;/&nbsp;{{ task.source_points }}
                {% else %}
                    <i class="glyphicon glyphicon-minus task-status-disabled" data-toggle="tooltip" data-placement="top" data-original-title="program: neodovzáva sa"></i>
                {% endif %}
            </td>
            {% endif %}
        {% endif %}
    </tr>
{% empty %}
    <tr>
        <td colspan="4">Žiadne úlohy</td>
    </tr>
{% endfor %}
</table>
</div>
